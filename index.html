<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SheetDB Pendientes - Estético</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      min-height: 100vh;
      margin: 0; padding: 0;
      font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg,#3477eb 0,#eef3fe 100%);
      display: flex; align-items: center; justify-content: center;
    }
    .container {
      background: rgba(255,255,255,0.88);
      margin: auto;
      border-radius: 20px;
      box-shadow: 0 16px 32px 0 #03368520, 0 2px 8px #5a6aea24;
      padding: 2rem 2rem 1.3rem 2rem; max-width: 410px; width:100%;
      animation: glassIn .7s;
    }
    @keyframes glassIn {
      from { opacity:0; transform:scale(.9);}
      to   { opacity:1; transform:scale(1);}
    }
    h1 {
      text-align:center;
      color: #256ed6; margin-bottom: .2em;
      letter-spacing:.7px; font-size:2em; font-weight:800;
      text-shadow: 0 2px 14px #3477eb21;
    }
    h2 {
      color: #093f85; margin: 2.3em 0 0.7em 0;
      font-size: 1.15em; font-weight:700; text-align:center;
    }
    .icon-user {
      font-size: 2.9em;
      color: #3477eb;
      display:block; width:100%; text-align:center;
      margin-bottom: .14em;
      opacity: .96;
      text-shadow: 0 2px 14px #3477eb34;
      animation: userIn .77s;
    }
    @keyframes userIn {
      from{opacity:0;transform:scale(.8);}
      to  {opacity:1;transform:scale(1);}
    }
    label {
      font-weight: 600; display: flex; align-items: center; margin-top:8px;
      font-size: 1.09em; color:#2252bc;
    }
    input[type="text"] {
      width: 90%; padding:13px 14px; margin:0.3em 0 1.17em 0;
      border-radius: 14px; border: 1.6px solid #b2cef5;
      background:#e6ecfa; font-size:1.03em; outline:none; box-shadow: none;
      transition: border 0.22s, background 0.2s;
    }
    input[type="text"]:focus {
      border:2px solid #256ed6; background:#f2f8ff;
    }
    button {
      background: linear-gradient(90deg, #256ed6 55%, #6fa7f8 145%);
      color: #fff; font-weight:bold; font-size: 1.1em;
      border: none; border-radius:11px; padding: 12px 0;
      width:100%; cursor:pointer; margin-top:0;
      box-shadow: 0 2px 10px #3477eb33;
      transition: background .17s, transform .13s, box-shadow .17s;
      display:flex; align-items:center; justify-content:center; gap:6px;
      letter-spacing:.8px;
    }
    button:hover {
      background: linear-gradient(90deg, #143b8d 0, #4b83db 100%);
      transform: scale(1.03); box-shadow: 0 4px 23px #256ed633;
    }
    #feedback { min-height: 2em; font-weight: 500; margin-top: 1.1em; text-align:center; font-size:1.17em; transition: color 0.33s;}
    .success { color: #21ab61; }
    .error { color: #e04747; }
    .table-wrapper {
      background: #f9fafb;
      border-radius: 14px; margin-top: 1em; padding: 0.7em .7em;
      box-shadow: 0 3px 12px #3477eb18;
      width: 99%; max-width:384px; margin-left:auto; margin-right:auto;
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #f7fafd;
      font-size: 1em;
      border-radius: 8px; overflow: hidden;
    }
    th, td {
      border: 1px solid #a9c7ee43;
      padding: 0.5em 0.9em; text-align: left; min-width:87px;
      font-size:1.03em; position:relative;
    }
    th {
      background: linear-gradient(90deg,#256ed6 60%, #4986db 100%);
      color: #fff; font-weight: 590; letter-spacing: .5px;
      font-size: 1.07em; border:none;
    }
    tr:nth-child(even) td { background:#e6ecfa;}
    .badge {
      display: inline-block; padding:.18em .85em .16em .85em; border-radius:8px;
      font-size:0.96em; font-weight:600; color:#fff; background:#e47b05;
      letter-spacing:.6px; margin-right:3px;
      box-shadow: 0 2px 5px #e47b0530;
      position:relative; top:-1.5px;
    }
    .actions { display: flex; gap: 13px; justify-content: center;}
    .icon-action {
      cursor: pointer; padding: 5px; border-radius:7px; border:none;
      font-size:1.15em; background:transparent;
      transition: background .15s, color .15s, transform .15s;
      color: #256ed6; outline:none; position:relative;
      box-shadow:none;
    }
    .icon-action.complete:hover { background:#e2f6e7; color:#21ab61; transform:scale(1.16);}
    .icon-action.delete:hover { background:#ffebe7; color:#db2323; transform:scale(1.15);}
    .icon-action:active {transform:scale(.93);}
    .icon-action[disabled] { color: #bbb; pointer-events:none;}
    .icon-action .fa { pointer-events:none;}
    .tooltip {
      visibility:hidden; opacity: 0;
      background: #232323ea; color: #fff; border-radius: 6px; padding: 2px 8px; font-size: 0.92em;
      position: absolute; z-index: 90; left: 50%; transform: translateX(-50%);
      bottom: 120%; white-space: nowrap; transition: opacity .17s;
    }
    .icon-action:hover .tooltip,
    .icon-action:focus .tooltip { visibility: visible; opacity: 1; }
    em { color: #474747;}
    @media (max-width:900px) {
      .container { max-width: 94vw; padding: 2rem 1.2rem 1.05rem 1.2rem; }
      .table-wrapper { max-width: 98vw; }
    }
    @media (max-width:600px) {
      .container { max-width: 99vw; padding: 1.3rem 0.4rem .7rem .4rem; }
      .table-wrapper { max-width: 99vw; padding:.7em .18em;}
      table {font-size: .98em;}
      input[type="text"] {font-size: .97em;}
      h1 {font-size:1.32em;}
      th, td {padding: .44em .45em; min-width:65px;}
    }
    @media (max-width:400px) {
      h1 {font-size:1.02em;}
      .container {padding: .8rem .1rem .5rem .1rem;}
      .table-wrapper {padding: .4em 0;}
      th, td {min-width:50px;}
    }
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <span class="icon-user"><i class="fa-solid fa-user"></i></span>
    <h1>Gestión de pendientes</h1>
    <form id="addRowForm" autocomplete="off">
      <label for="nombre"><i class="fa-regular fa-address-card" style="margin-right:7px;"></i>Nombre:</label>
      <input type="text" required id="nombre" name="nombre" maxlength="60" autocomplete="off" placeholder="Ingresa nombre..."/>
      <button type="submit"><i class="fa-solid fa-plus"></i> Agregar</button>
    </form>
    <div id="feedback"></div>
    <h2>Lista de pendientes</h2>
    <div class="table-wrapper"><div id="spreadsheet"></div></div>
    <div id="error" class="error"></div>
  </div>
  <script>
    const endpoint = "https://sheetdb.io/api/v1/q52hcwnsqokuu";
    document.getElementById("addRowForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const nombre = document.getElementById("nombre").value.trim();
      if(!nombre) {
        document.getElementById("feedback").textContent = "El campo nombre no puede estar vacío.";
        document.getElementById("feedback").className = "error";
        return;
      }
      const datos = {data: [{ "Nombre": nombre, "Completado": "FALSE" }]};
      const btn = document.querySelector("button");
      btn.disabled = true; btn.style.opacity = .7;
      fetch(endpoint, {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify(datos)
      })
      .then(res => {
        btn.disabled = false; btn.style.opacity = 1;
        if (!res.ok) throw new Error("No se pudo agregar el dato");
        return res.json();
      })
      .then(response => {
        document.getElementById("feedback").textContent = "¡Dato agregado correctamente!";
        document.getElementById("feedback").className = "success";
        document.getElementById("addRowForm").reset();
        setTimeout(() => { cargarDatos(); }, 700);
      })
      .catch(err => {
        btn.disabled = false; btn.style.opacity = 1;
        document.getElementById("feedback").textContent = "Error al agregar dato: " + err.message;
        document.getElementById("feedback").className = "error";
      });
    });

    function cargarDatos() {
      fetch(endpoint)
        .then(res => { if (!res.ok) throw new Error("No se pudo cargar la hoja"); return res.json(); })
        .then(data => {
          let filtered = data
            .filter(row => row["Completado"] && row["Completado"].toString().toUpperCase() === "FALSE")
            .reverse();
          let html = '';
          if (filtered.length > 0) {
            html += `<table>
              <tr>
                <th>Nombre</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>`;
            filtered.forEach((row, idx) => {
              const rowIndex = data.indexOf(row) + 2;
              html += `<tr>
                <td>${row["Nombre"] || "-"}</td>
                <td><span class="badge"><i class="fa-solid fa-hourglass-half"></i> Pendiente</span></td>
                <td>
                  <div class="actions">
                    <button class="icon-action complete" title="Marcar como completado" onclick="marcarCompletado(${rowIndex})">
                      <span class="tooltip">Completar</span>
                      <i class="fa-solid fa-circle-check"></i>
                    </button>
                    <button class="icon-action delete" title="Eliminar registro" onclick="eliminarRegistro(${rowIndex})">
                      <span class="tooltip">Eliminar</span>
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>`;
            });
            html += "</table>";
          } else {
            html = "<em>No hay registros con Completado = FALSE.</em>";
          }
          document.getElementById("spreadsheet").innerHTML = html;
          document.getElementById("error").textContent = "";
        })
        .catch(err => {
          document.getElementById("error").textContent = "Error cargando datos: " + err.message;
        });
    }
    window.marcarCompletado = function(rowIndex) {
      fetch(`${endpoint}/row/${rowIndex}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ "Completado": "TRUE" })
      })
      .then(res => {
        if (!res.ok) throw new Error("No se pudo marcar como completado");
        return res.json();
      })
      .then(response => { cargarDatos(); })
      .catch(err => {
        document.getElementById("error").textContent = "Error al actualizar: " + err.message;
      });
    };
    window.eliminarRegistro = function(rowIndex) {
      if(!confirm("¿Seguro que deseas eliminar este registro?")) return;
      fetch(`${endpoint}/row/${rowIndex}`, {
        method: "DELETE",
      })
      .then(res => {
        if (!res.ok) throw new Error("No se pudo eliminar el registro");
        return res.json();
      })
      .then(response => { cargarDatos(); })
      .catch(err => {
        document.getElementById("error").textContent = "Error al eliminar: " + err.message;
      });
    };
    cargarDatos();
  </script>
</body>
</html>
